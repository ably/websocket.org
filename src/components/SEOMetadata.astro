---
export interface Props {
  title: string;
  description: string;
  author?: string;
  authorRole?: string;
  keywords?: string[];
  canonicalUrl?: string;
  ogImage?: string;
  ogType?: string;
  twitterCard?: string;
  publishedDate?: string;
  modifiedDate?: string;
  category?: string;
}

const {
  title,
  description,
  author = "Matt O'Riordan",
  authorRole = "Co-founder & CEO, Ably",
  keywords = [],
  canonicalUrl,
  ogImage = '/images/og/default.png',
  ogType = 'article',
  twitterCard = 'summary_large_image',
  publishedDate,
  modifiedDate,
  category = 'guide'
} = Astro.props;

const siteUrl = 'https://websocket.org';
const fullCanonicalUrl = canonicalUrl ? `${siteUrl}${canonicalUrl}` : Astro.url.href;
const fullOgImage = ogImage.startsWith('http') ? ogImage : `${siteUrl}${ogImage}`;
---

<!-- Primary Meta Tags -->
<meta name="title" content={title} />
<meta name="description" content={description} />
{keywords.length > 0 && <meta name="keywords" content={keywords.join(', ')} />}
<meta name="author" content={author} />

<!-- Canonical URL -->
<link rel="canonical" href={fullCanonicalUrl} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={fullCanonicalUrl} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={fullOgImage} />
<meta property="og:site_name" content="WebSocket.org" />
{publishedDate && <meta property="article:published_time" content={publishedDate} />}
{modifiedDate && <meta property="article:modified_time" content={modifiedDate} />}
{author && <meta property="article:author" content={author} />}
{category && <meta property="article:section" content={category} />}

<!-- Twitter -->
<meta name="twitter:card" content={twitterCard} />
<meta name="twitter:url" content={fullCanonicalUrl} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={fullOgImage} />
<meta name="twitter:creator" content="@mattyoriordan" />
<meta name="twitter:site" content="@ablyrealtime" />

<!-- JSON-LD Structured Data -->
<script type="application/ld+json" set:html={JSON.stringify({
  "@context": "https://schema.org",
  "@type": ogType === 'article' ? 'TechArticle' : 'WebPage',
  "headline": title,
  "description": description,
  "url": fullCanonicalUrl,
  "image": fullOgImage,
  "author": {
    "@type": "Person",
    "name": author,
    "jobTitle": authorRole,
    "url": "https://twitter.com/mattyoriordan"
  },
  "publisher": {
    "@type": "Organization",
    "name": "WebSocket.org",
    "logo": {
      "@type": "ImageObject",
      "url": `${siteUrl}/images/logo.png`
    }
  },
  ...(publishedDate && { "datePublished": publishedDate }),
  ...(modifiedDate && { "dateModified": modifiedDate }),
  ...(keywords.length > 0 && { "keywords": keywords }),
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": fullCanonicalUrl
  }
})}>
</script>